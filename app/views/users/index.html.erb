<div class="container mx-auto mt-3" style="position: relative;">
  <div class="row">
    <% @users.each do |user| %>
        <div class="col-md-4 mt-3">
        <%= link_to user_path(user), class: "text-dark" do %>
          <div class="card" style="width: 300px; heigth: 600px;">

              <%= image_tag(user.avatar, class: 'card-img-top rounded-circle', style: "background-color: #{user.avatar_color}") %>
              <div class="card-body">
                <h5 class="card-title"><%= user.nickname %></h5>
                <div class="d-flex">
                <h6 class="card-subtitle mb-2 text-muted"><%= user.score %> points</h6>
                <% if current_user && user.latitude && user.longitude %>
                <h6 class="card-subtitle mb-2 text-muted ms-3">Distance: <%= (current_user.distance_from(user) * 1000).round %> m</h6>
                <% end %>
                </div>
                <p class="card-text"><%= user.bio %></p>
                <%= link_to 'Hug request', hugs_path(user_id: user.id), method: :post, class: 'btn btn-success mb-2' %>
                <% if user.logged_in? %>
                  <p class="card-text">Online</p>
                <% elsif user.last_request_at == nil%>
                  <p class="card-text">Waiting for 1st connexion</p>
                <% else %>
                  <p class="card-text">Online <%= ((Time.now - (user.last_request_at))/60).round %> minutes ago</p>
                <% end %>
              </div>
           </div>
        <% end %>
        </div>
    <% end %>
  </div>

  <div class="card p-3 m-3" id="map">
    <div style="width: 100%; height: 600px;"
      data-controller="mapbox"
      data-mapbox-markers-value="<%= @markers.to_json %>"
      data-mapbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
    </div>
  </div>

  <div class="map-icon">
    <a href="/users/#map"><i class="fa-solid fa-map-location"></i></a>
  </div>
</div>
